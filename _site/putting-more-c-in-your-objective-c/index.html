<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Putting more "C" in your Objective-C &#8211; #justcodingthings</title>
<meta name="description" content="Where I ramble about inability to create 'true' private methods for Objective-C classes.">
<meta name="keywords" content="objective-c, c, coding style, private, UIView, initializers">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Putting more "C" in your Objective-C">
<meta name="twitter:description" content="Where I ramble about inability to create 'true' private methods for Objective-C classes.">
<meta name="twitter:creator" content="@wanderwaltz">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Putting more "C" in your Objective-C">
<meta property="og:description" content="Where I ramble about inability to create 'true' private methods for Objective-C classes.">
<meta property="og:url" content="/putting-more-c-in-your-objective-c/">
<meta property="og:site_name" content="#justcodingthings">





<link rel="canonical" href="/putting-more-c-in-your-objective-c/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="#justcodingthings Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="Egor Chiglintsev photo" class="author-photo">
					<h4>Egor Chiglintsev</h4>
					<p>iOS developer since June 2009</p>
				</li>
				<li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				
				<li>
					<a href="http://twitter.com/wanderwaltz"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="http://linkedin.com/in/chiglintsev"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/wanderwaltz"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">All Posts</a></li>
				<li><a href="/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/putting-more-c-in-your-objective-c/" rel="bookmark" title="Putting more "C" in your Objective-C">Putting more "C" in your Objective-C</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-03-26T00:00:00+06:00">March 26, 2015</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~4 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>I like Objective-C. I’ve been writing Objective-C code for almost 6 years now and I can surely say
that I’m comfortable with the language and that it provides everything I need to make awesome apps.
But nothing is perfect of course.</p>

<p>The dynamic nature of the language can be a woe at some times. One of such things is lack of proper
private methods in Objective-C. Whether you like it or not, whatever you call your method, it could
be overridden in a subclass even if you don’t really want it to be overridden. More so, if your
method is not listed in the header file, someone could override your ‘private’ hidden method even
without realizing it. Who knows what will happen in that case. Hopefully your app will crash
fast and early.</p>

<p>I have a small silly practical reason to talk about it right now. I’ve been creating a lot of
<code>IB_DESIGNABLE</code> views recently and therefore as a responsible person I have to override two
initializers<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> for each of them:</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="c1">// if someone wants to create such view in code</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">frame</span><span class="p">;</span>

<span class="c1">// will be called when loading from a xib or storyboard</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">initWithCoder:</span><span class="p">(</span><span class="bp">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aDecoder</span><span class="p">;</span></code></pre></div>

<p>Often the code that goes in these initializers is actually the same. It creates some subviews or
maybe sets up some initial internal state of the view - whatever. So I create a method which
actually does all the setup and is called by both of these initializers:</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">private_setup</span>
<span class="p">{</span>
    <span class="c1">// Create subviews, set up state etc.</span>
<span class="p">}</span></code></pre></div>

<p>I prefix the name of this method with <code>private_</code> to notify myself and my teammates that this
method should not be exposed to the outside world and is actually private implementation detail
of my class.</p>

<p>It gets kind of ugly when I’m trying to subclass such a view. I want then to have another common
setup logic specific to the subclass, but I cannot actually use the name private_setup anymore.
Otherwise it would override the logic of the superclass initialization and I won’t be able to call
super since the method is not exposed anywhere.</p>

<p>This is actually not a real problem. I can instantly name at least two possible solutions to
that which aren’t even hard to do:</p>

<ul>
  <li>
    <p>The most obvious one is to expose some kind of setup method, tag it with <code>NS_REQUIRES_SUPER</code>
and call it a day. It is probably the simplest one to go with, but I’m really in a mood to dig
deeper today. What if someone would call this method manually? Since it is exposed, someone might
just do that. It also may become kind of confusing. Instead of knowing about the two initializers
of the class we also should keep in mind the setup method and always remember when it gets called
and whether it is safe to use other methods or properties of this class from this method etc. etc.</p>
  </li>
  <li>
    <p>Give the ‘private’ method a more complex class-dependent name that is less likely to be overridden
by mistake: <code>private_MyAwesomeIBDesignableViewClass_setup</code> for example. And then in subclass
use something like <code>private_MyEvenMoreAwesomeIBDesignableViewClassSubclass_setup</code>.
How’s that sound? Ugly, I know.</p>
  </li>
</ul>

<p>Both these solutions work and both are kind of OK, but I want more. I want actual private methods
for my classes which could not possibly be ever called by anyone else and which won’t name clash so
I could use simple identifiers like <code>private_setup</code>. Can Objective-C help me with that?</p>

<p>Apparently Objective-C does not, but plain old C probably will.</p>

<p>I’ve ended up using this kind of construct:</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="k">@implementation</span> <span class="nc">MyView</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">frame</span>
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithFrame</span><span class="p">:</span> <span class="n">frame</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">private_setup</span><span class="p">(</span><span class="nb">self</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>


<span class="p">-</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">initWithCoder:</span><span class="p">(</span><span class="bp">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">coder</span>
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithCoder</span><span class="p">:</span> <span class="n">coder</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">private_setup</span><span class="p">(</span><span class="nb">self</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">private_setup</span><span class="p">(</span><span class="n">MyView</span> <span class="o">*</span><span class="nb">self</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Here we do the common initialization.</span>
    <span class="c1">// Using `self` as an explicit variable in a C function instead of</span>
    <span class="c1">// using an Objective-C method provides almost no inconvenience except</span>
    <span class="c1">// that if you&#39;re accessing ivars, you have to write self-&gt;_ivarName</span>
    <span class="c1">// instead of just _ivarName.</span>
<span class="p">}</span>

<span class="k">@end</span></code></pre></div>

<p>So a static C function which accepts <code>self</code> as a parameter (any other parameters can be added as
needed) does pretty much exactly what’s needed in terms of privacy and non-overridability.</p>

<p>I know a couple of people who probably would say that this kind of code is even more ugly than the
variants I’ve listed before (I’m looking at you <a href="http://twitter.com/stkhapugin">@stkhapugin</a>), but
I’m quite fond with it at the moment. It does everything I wanted to and does not require any
obscure runtime or preprocessor magic to implement. I call it a win.</p>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>The designated initializer for an <code>UIView</code> subclass is of course the <code>initWithFrame:</code> one, but
  when loading the view from a storyboard or a xib it won’t be called in favor of the <code>initWithCoder:</code>. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#objective-c" title="Pages tagged objective-c" class="tag"><span class="term">objective-c</span></a><a href="/tags/#c" title="Pages tagged c" class="tag"><span class="term">c</span></a><a href="/tags/#coding style" title="Pages tagged coding style" class="tag"><span class="term">coding style</span></a><a href="/tags/#private" title="Pages tagged private" class="tag"><span class="term">private</span></a><a href="/tags/#UIView" title="Pages tagged UIView" class="tag"><span class="term">UIView</span></a><a href="/tags/#initializers" title="Pages tagged initializers" class="tag"><span class="term">initializers</span></a></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2015-03-26">March 26, 2015</time></span></span>
        <span class="author vcard"><span class="fn">Egor Chiglintsev</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/putting-more-c-in-your-objective-c/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/putting-more-c-in-your-objective-c/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/putting-more-c-in-your-objective-c/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
  <div class="read-more-list">
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Egor Chiglintsev. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'justcodingthings'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
